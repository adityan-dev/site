name: Personal Website

on:
	push:
		branches: [ main ]
	pull_request:
		branches: [ main ]

permissions:
	contents: write
	pages: write
	id-token: write

jobs:
	build:
		runs-on: ubuntu-latest
		if: "!contains(github.event.head_commit.message, '[SKIP]')"
		steps:
			- name: Checkout
				uses: actions/checkout@v4
			- name: Setup Emacs
				uses: purcell/setup-emacs@v7.0
				with:
					version: 28.1
			- name: Run Emacs Org mode publish to convert Org mode files to HTML
				run: ./build.sh
			- name: Upload artifact
				uses: actions/upload-pages-artifact@v3
				with:
					path: ./public
	deploy:
		environment:
			name: github-pages
			url: ${{ steps.deployment.outputs.page_url }}
			runs-on: ubuntu-latest
			needs: build
			if: "github.event_name != 'pull_request' && !contains(github.event.head_commit.message, '[SKIP]')"
			steps:
				- name: Deploy to GitHub Pages
					id: deployment
					uses: actions/deploy-pages@v4
